(this.webpackJsonptodonotes=this.webpackJsonptodonotes||[]).push([[1],{314:function(t,e){},330:function(t,e,n){t.exports=n(605)},335:function(t,e,n){var r={"./ion-action-sheet.entry.js":[610,5],"./ion-alert.entry.js":[611,6],"./ion-app_8.entry.js":[612,7],"./ion-avatar_3.entry.js":[613,17],"./ion-back-button.entry.js":[614,18],"./ion-backdrop.entry.js":[615,43],"./ion-button_2.entry.js":[616,19],"./ion-card_5.entry.js":[617,20],"./ion-checkbox.entry.js":[618,21],"./ion-chip.entry.js":[619,22],"./ion-col_3.entry.js":[620,44],"./ion-datetime_3.entry.js":[621,10],"./ion-fab_3.entry.js":[622,23],"./ion-img.entry.js":[623,45],"./ion-infinite-scroll_2.entry.js":[624,46],"./ion-input.entry.js":[625,24],"./ion-item-option_3.entry.js":[626,25],"./ion-item_8.entry.js":[627,26],"./ion-loading.entry.js":[628,27],"./ion-menu_3.entry.js":[629,28],"./ion-modal.entry.js":[630,8],"./ion-nav_2.entry.js":[631,14],"./ion-popover.entry.js":[632,9],"./ion-progress-bar.entry.js":[633,29],"./ion-radio_2.entry.js":[634,30],"./ion-range.entry.js":[635,31],"./ion-refresher_2.entry.js":[636,11],"./ion-reorder_2.entry.js":[637,16],"./ion-ripple-effect.entry.js":[638,47],"./ion-route_4.entry.js":[639,32],"./ion-searchbar.entry.js":[640,33],"./ion-segment_2.entry.js":[641,34],"./ion-select_3.entry.js":[642,35],"./ion-slide_2.entry.js":[643,48],"./ion-spinner.entry.js":[644,13],"./ion-split-pane.entry.js":[645,49],"./ion-tab-bar_2.entry.js":[646,36],"./ion-tab_2.entry.js":[647,15],"./ion-text.entry.js":[648,37],"./ion-textarea.entry.js":[649,38],"./ion-toast.entry.js":[650,39],"./ion-toggle.entry.js":[651,12],"./ion-virtual-scroll.entry.js":[652,50]};function a(t){if(!n.o(r,t))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=r[t],a=e[0];return n.e(e[1]).then((function(){return n(a)}))}a.keys=function(){return Object.keys(r)},a.id=335,t.exports=a},337:function(t,e,n){var r={"./ion-icon.entry.js":[654,57]};function a(t){if(!n.o(r,t))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=r[t],a=e[0];return n.e(e[1]).then((function(){return n(a)}))}a.keys=function(){return Object.keys(r)},a.id=337,t.exports=a},338:function(t,e,n){},344:function(t,e){},346:function(t,e){},357:function(t,e){},359:function(t,e){},386:function(t,e){},387:function(t,e){},392:function(t,e){},394:function(t,e){},418:function(t,e){},485:function(t,e){},497:function(t,e){},503:function(t,e){},593:function(t,e,n){},594:function(t,e,n){},595:function(t,e,n){},596:function(t,e,n){},597:function(t,e,n){},603:function(t,e,n){},605:function(t,e,n){"use strict";n.r(e);var r,a=n(0),o=n.n(a),i=n(151),c=n.n(i),s=n(26),u=n(16),l=n(41),d=(n(338),n(62)),f=n(65),p=n(206),g=n.n(p);n(174);function h(t,e){var n=v();if(n){var a=Object(f.a)(Object(f.a)({},n),{},Object(d.a)({},t,e));r=a;var o=JSON.stringify(a);Object(u.q)("electron")?localStorage.setItem("settings",o):g.a.set("settings",o)}}function m(t){return v()[t]}function b(){return void 0!==m("userEmail")&&void 0!==m("apiToken")&&void 0!==m("renewalToken")&&void 0!==m("tokenExpiration")}function v(){if(r)return r;var t,e=(t=Object(u.q)("electron")?localStorage.getItem("settings"):g.a.get("settings")||null)&&JSON.parse(t);return t&&e?r=e:{userEmail:void 0,apiToken:void 0,renewalToken:void 0,tokenExpiration:void 0}}var O=n(10),j=n.n(O),y=n(153),k=n(31),E=n(104),w=n(321),x=n(661),I=n(171),C=n(170),N=n(166),S=n(662),T=n(81),D=n(167),M=n.n(D),q="https://todonotes.gigalixirapp.com",_="".concat(q,"/api/graphql"),A={version:0,type:"object",properties:{id:{type:"string",primary:!0},title:{type:"string"},content:{type:"string"},tagCount:{type:"number"},trashed:{type:"boolean"},updatedAt:{type:"string",format:"date-time"},insertedAt:{type:"string",format:"date-time"}},indexes:["id","insertedAt"]},B={name:"notes",schema:A,statics:{getUntrashedNotes:function(){return this.find().where("trashed").eq(!1)},getUntaggedNotes:function(){return this.getUntrashedNotes().where("tagCount").eq(0)}},methods:{trash:function(){var t=this,e=this.atomicPatch({trashed:!0});return Q().then((function(e){e.tagnotes.findForNote(t).then((function(t){t.forEach(function(){var t=Object(k.a)(j.a.mark((function t(e){var n;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.populate("tagId");case 2:(n=t.sent).atomicPatch({noteCount:n.noteCount-1});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}))})),e},untrash:function(){var t=this,e=this.atomicPatch({trashed:!1});return Q().then((function(e){e.tagnotes.findForNote(t).then((function(t){t.forEach(function(){var t=Object(k.a)(j.a.mark((function t(e){var n;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.populate("tagId");case 2:(n=t.sent).atomicPatch({noteCount:n.noteCount+1});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}))})),e}}},$=nt(A),R={version:0,type:"object",properties:{id:{type:"string",primary:!0},name:{type:"string"},noteCount:{type:"integer"},insertedAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},indexes:["name"]},U={name:"tags",schema:R,methods:{delete:function(){var t=Object(k.a)(j.a.mark((function t(){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Q();case 2:t.sent,this.remove();case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},statics:{findByNameOrCreate:function(){var t=Object(k.a)(j.a.mark((function t(e){var n;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.findOne().where("name").eq(e).exec();case 2:if(!(n=t.sent)){t.next=5;break}return t.abrupt("return",n);case 5:return t.next=7,this.create({id:X(),name:e,noteCount:0,insertedAt:tt(),updatedAt:tt()});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),all:function(){return this.find()},create:function(t){return this.insert(t)},getTag:function(t){return this.findOne().where("tagId").eq(t).exec()}},migrationStrategies:{}},F=nt(R),L={version:0,type:"object",properties:{id:{type:"string",primary:!0},noteId:{ref:"notes",type:"string"},tagId:{ref:"tags",type:"string"},position:{type:"number"},insertedAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},indexes:["tagId","position"]};var P,z={name:"tagnotes",schema:L,methods:{},statics:{getNotesForTag:function(t){return this.find().where("tag").eq(t.name).sort("position")},upsertNoteForTag:function(t,e){var n=this;return Object(k.a)(j.a.mark((function r(){var a,o;return j.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.findNoteTag(t,e);case 2:if(!(a=r.sent)){r.next=5;break}return r.abrupt("return",a);case 5:return r.next=7,n.getNotesForTag(t).exec();case 7:return o=r.sent,r.abrupt("return",n.insert({id:X(),noteId:e,tagId:t.id,position:o.length,insertedAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}));case 9:case"end":return r.stop()}}),r)})))()},findNoteTag:function(t,e){return this.findOne().where("tagId").eq(t.id).where("noteId").eq(e).exec()},findForNote:function(t){return this.find().where("noteId").eq(t.id).exec()}},migrationStrategies:{}},J=nt(L);function W(t){return H.apply(this,arguments)}function H(){return(H=Object(k.a)(j.a.mark((function t(e){var r;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Object(E.a)(n(606)),t.next=3,Object(E.b)({name:e,adapter:"idb",multiInstance:!1});case 3:return r=t.sent,t.next=6,r.addCollections({notes:B,tags:U,tagnotes:z});case 6:return et(),t.abrupt("return",r);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}Object(E.a)(w.a),Object(E.a)(I.a),Object(E.a)(C.a),Object(E.a)(N.a),setInterval((function(){var t=m("tokenExpiration"),e=t&&parseInt(t);if(e&&(new Date).getTime()>e-9e5){console.log("renewing token");var n=m("renewalToken");n&&function(t){M.a.request({method:"POST",url:"".concat(q,"/api/v1/session/renew"),headers:{authorization:t}}).then((function(t){var e=t.data.data,n=e.access_token,r=e.renewal_token,a=(new Date).getTime()+174e4;h("apiToken",n),h("renewalToken",r),h("tokenExpiration",a.toString()),G()})).catch((function(){}))}(n)}}),15e3);var K=[{collection:function(t){return t.notes},pull:{queryBuilder:function(t){return t||(t={updatedAt:new Date(0).toISOString()}),{query:'\n    {\n      queryNotesForReplication(minUpdatedAt: "'.concat(t.updatedAt,'") {\n        ').concat($,"\n      }\n    }\n  "),variables:{}}}},push:{queryBuilder:function(t){return{query:"\n    mutation CreateNote($note: NoteInput) {\n      createNote(note: $note) {\n        ".concat($,"\n      }\n    }\n  "),variables:{note:t}}}},state:null},{collection:function(t){return t.tags},pull:{queryBuilder:function(t){return t||(t={updatedAt:new Date(0).toISOString()}),{query:'\n    {\n      queryTagsForReplication(minUpdatedAt: "'.concat(t.updatedAt,'") {\n        ').concat(F,"\n      }\n    }\n  "),variables:{}}}},push:{queryBuilder:function(t){return{query:"\n    mutation CreateTag($tag: TagInput) {\n      createTag(tag: $tag) {\n        ".concat(F,"\n      }\n    }\n  "),variables:{tag:t}}}},state:null},{collection:function(t){return t.tagnotes},pull:{queryBuilder:function(t){return t||(t={updatedAt:new Date(0).toISOString()}),{query:'\n    {\n      queryTagNotesForReplication(minUpdatedAt: "'.concat(t.updatedAt,'") {\n        ').concat(J,"\n      }\n    }\n  "),variables:{}}}},push:{queryBuilder:function(t){return{query:"\n    mutation CreateTagNote($tagNote: TagNoteInput) {\n      createTagNote(tagNote: $tagNote) {\n        ".concat(J,"\n      }\n    }\n  "),variables:{tagNote:t}}}},state:null}];function G(){Q().then((function(t){var e=m("apiToken");e&&e.length>0&&K.forEach((function(n,r){var a=n.collection,o=n.pull,i=n.push,c=n.state;if(c)c.setHeaders({authorization:e}),c.run();else{console.log("Setting up GraphQL sync...");var s=a(t).syncGraphQL({url:_,headers:{authorization:e},pull:o,push:i,deletedFlag:"deleted",live:!0});s.error$.subscribe((function(t){console.log("something went wrong"),console.dir(t)})),K[r].state=s}}))}))}function Q(){return V.apply(this,arguments)}function V(){return(V=Object(k.a)(j.a.mark((function t(){var e,n;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=m("userId"),!P&&e&&(n="notan_".concat(e.replace(/-/g,"_")),P=W(n)),t.abrupt("return",P);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function X(){return Object(x.a)()}var Y=function(t,e,n,r){return Z(t,e,n,r).pipe(Object(T.a)((function(t){return t.filter((function(t){return null!=Object(s.a)(t,2)[1]}))})))},Z=function(t,e,n,r){return Object(S.a)([t,e]).pipe(Object(T.a)((function(t){var e=Object(s.a)(t,2),a=e[0],o=e[1];if(!a)return[];o||(o=[]);var i,c=new Map,u=Object(y.a)(o);try{for(u.s();!(i=u.n()).done;){var l=i.value;c.set(r(l),l)}}catch(d){u.e(d)}finally{u.f()}return a.map((function(t){return[t,c.get(n(t))]}))})))};function tt(){return(new Date).toISOString()}function et(){Q().then((function(t){t.tagnotes.postInsert((function(e,n){t.tags.findOne(n.tagId).exec().then((function(t){null===t||void 0===t||t.atomicUpdate((function(t){return Object(f.a)(Object(f.a)({},t),{},{noteCount:t.noteCount+1})}))})),t.notes.findOne(n.noteId).exec().then((function(t){null===t||void 0===t||t.atomicUpdate((function(t){return Object(f.a)(Object(f.a)({},t),{},{tagCount:t.tagCount+1})}))}))}),!1),t.tagnotes.postRemove((function(e,n){t.tags.findOne(n.tagId).exec().then((function(t){null===t||void 0===t||t.atomicUpdate((function(t){return Object(f.a)(Object(f.a)({},t),{},{noteCount:t.noteCount-1})}))})),t.notes.findOne(n.noteId).exec().then((function(t){null===t||void 0===t||t.atomicUpdate((function(t){return Object(f.a)(Object(f.a)({},t),{},{tagCount:t.tagCount-1})}))}))}),!1)}))}function nt(t){return Object.keys(t.properties).concat(["deleted"]).join("\n")}var rt=function(t){var e=t.onLogout,n=t.onContextChange,r=t.currentContext,i=t.onTagChange,c=t.selectedTag,d=Object(a.useState)([]),f=Object(s.a)(d,2),p=f[0],g=f[1],m=Object(a.useState)(null),b=Object(s.a)(m,2),v=b[0],O=b[1];Object(a.useEffect)((function(){var t=[];return Q().then((function(e){var n=e.tags.find().$.subscribe((function(t){g(t)}));t.push(n);var r=e.notes.getUntaggedNotes().$.subscribe((function(t){O(t.length)}));t.push(r)})),function(){t.forEach((function(t){return t.unsubscribe()}))}}),[]);var j=[{title:"No Tags",iosIcon:l.c,mdIcon:l.c,count:v,context:"inbox"},{title:"Trash",iosIcon:l.p,mdIcon:l.p,count:null,context:"trash"}];return o.a.createElement("div",{className:"menu"},o.a.createElement("div",{className:"ion-padding-start"},o.a.createElement("div",{className:"menu-header",style:{display:"flex",flexDirection:"column"}},o.a.createElement(u.b,{expand:"block",className:"ion-align-self-center",fill:"clear",size:"small",color:"medium",onClick:function(){K.forEach((function(t){var e=t.state;e&&e.setHeaders({authorization:""})})),h("userEmail",void 0),h("apiToken",void 0),h("renewalToken",void 0),h("tokenExpiration",void 0),e()}},"logout"))),o.a.createElement("div",{className:"pages list"},j.map((function(t,e){return o.a.createElement("div",{key:e,className:"page button ".concat(t.context===r?"selected":""),onClick:function(){return n(t.context)}},o.a.createElement(u.c,{slot:"start",ios:t.iosIcon,md:t.mdIcon}),o.a.createElement("span",{className:"content"},t.title),o.a.createElement("span",{className:"count"},t.count))}))),o.a.createElement("br",null),o.a.createElement("div",{className:"tags list"},p.map((function(t,e){return o.a.createElement("div",{key:e,className:"tag button ".concat("tag"===r&&c===t?"selected":""),onClick:function(){i(t),n("tag")}},o.a.createElement("span",{className:"content"},"#",t.name),o.a.createElement("span",{className:"count"},t.noteCount))}))))},at=n(326),ot=n(68),it=(n(583),n(584),n(585),n(586),n(587),n(588),n(589),n(590),n(591),n(592),n(593),n(594),n(595),function(t){var e=t.onSuccess,n=Object(a.useState)("login"),r=Object(s.a)(n,2),i=r[0],c=r[1],l=Object(a.useState)(""),d=Object(s.a)(l,2),f=d[0],p=d[1],g=Object(a.useState)(""),m=Object(s.a)(g,2),b=m[0],v=m[1],O=Object(a.useState)(""),j=Object(s.a)(O,2),y=j[0],k=j[1],E=Object(a.useState)(!1),w=Object(s.a)(E,2),x=w[0],I=w[1],C=Object(a.useState)(),N=Object(s.a)(C,2),S=N[0],T=N[1],D=Object(a.useRef)(null);function _(){var t="".concat(q,"login"===i?"/api/v1/session":"/api/v1/registration");M.a.post(t,{user:{email:f,password:b,password_confirmation:y}}).then((function(t){var n=t.data.data,r=n.access_token,a=n.renewal_token,o=n.user_id,i=(new Date).getTime()+174e4;h("userId",o),h("tokenExpiration",i.toString()),h("userEmail",f),h("apiToken",r),h("renewalToken",a),G(),e()})).catch((function(t){var e;if(401===t.response.status&&(e=["Invalid email or password"]),500===t.response.status){var n=t.response.data.error.errors;e=Object.keys(n).map((function(t){var e=t;return"password_confirmation"===t&&(e="password"),"".concat(e," ").concat(n[t])}))}I(!0),T(e)}))}function A(t){c(t),I(!1)}return Object(a.useEffect)((function(){setTimeout((function(){var t;null===(t=D.current)||void 0===t||t.setFocus()}),500)}),[]),o.a.createElement("form",{id:"loginForm",onSubmit:function(t){t.preventDefault(),_()}},x&&o.a.createElement("div",{style:{padding:"1em 1.7em",textAlign:"left",backgroundColor:"#c88",color:"#fff",margin:30,borderRadius:11}},null===S||void 0===S?void 0:S.map((function(t,e){return o.a.createElement("div",{key:e},t)}))),o.a.createElement(u.e,null,o.a.createElement(u.d,{type:"text",name:"email",ref:D,placeholder:"Email",onIonInput:function(t){return p(t.target.value)},onKeyUp:function(t){return"Enter"===t.key&&_()}})),o.a.createElement(u.e,null,o.a.createElement(u.d,{type:"password",name:"password",placeholder:"Password",onIonChange:function(t){return v(t.target.value)},onKeyUp:function(t){return"Enter"===t.key&&_()}})),"registration"===i&&o.a.createElement(u.e,null,o.a.createElement(u.d,{type:"password",name:"password_confirmation",placeholder:"Confirm Password",onIonChange:function(t){return k(t.target.value)},onKeyUp:function(t){return"Enter"===t.key&&_()}})),o.a.createElement(u.b,{type:"submit",color:"dark"},"login"===i?"Login":"Register"),"login"===i?o.a.createElement("a",{href:"#",onClick:function(){return A("registration")}},"Register"):o.a.createElement("a",{href:"#",onClick:function(){return A("login")}},"Login"))}),ct=(n(596),n(7)),st=n(319),ut=n(3),lt=n(140),dt=n(95),ft=n(48),pt=(n(597),new ut.i({nodes:{doc:{attrs:{noteId:{default:null}},content:"heading block+"},paragraph:{group:"block",content:"inline*",attrs:{spellcheck:{default:"false"}},parseDOM:[{tag:"p"}],toDOM:function(t){return["p",t.attrs,0]}},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!1,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:function(t){return["h"+t.attrs.level,{class:"heading",level:t.attrs.level},0]}},bulletList:{group:"block",content:"listItem+",parseDOM:[{tag:"ul"}],toDOM:function(t){return["ul",t.attrs,0]}},listItem:{defining:!0,content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:function(t){return["li",t.attrs,0]}},underline:{group:"block",content:"inline*",attrs:{spellcheck:{default:"false"}},parseDOM:[{tag:"p"}],toDOM:function(t){return["p",t.attrs,0]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:function(){return["blockquote",0]}},horizontalRule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:function(){return["hr"]}},codeBlock:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:function(){return["pre",["code",0]]}},hardBreak:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:function(){return["br"]}},hashTag:{group:"inline",inline:!0,atom:!0,content:"text*",isolating:!0,attrs:{tag:{default:""}},selectable:!0,draggable:!1,toDOM:function(t){return["span",{"data-tag":t.attrs.tag,class:"hashtag"},"#".concat(t.attrs.tag)]},parseDOM:[{tag:"span[data-tag]",getAttrs:function(t){return{tag:t instanceof Element?t.getAttribute("data-tag"):""}}}]},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:function(t){if(t instanceof globalThis.Element)return{src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")}}}],toDOM:function(t){var e=t.attrs;return["img",{src:e.src,alt:e.alt,title:e.title}]}},text:{group:"inline"}},marks:{strong:{parseDOM:[{tag:"b"},{tag:"strong"}],toDOM:function(t){return["b",t.attrs,0]}},em:{parseDOM:[{tag:"em"}],toDOM:function(t){return["em",t.attrs,0]}}}})),gt=n(58);function ht(t){return pt.nodes.hashTag.create({tag:t})}function mt(t){var e,n,r=gt.e.concat(gt.b,gt.c);return(e=t.nodes.blockquote)&&r.push((n=e,Object(gt.h)(/^\s*>\s$/,n))),(e=t.nodes.ordered_list)&&r.push(function(t){return Object(gt.h)(/^(\d+)\.\s$/,t,(function(t){return{order:+t[1]}}),(function(t,e){return e.childCount+e.attrs.order==+t[1]}))}(e)),(e=t.nodes.bulletList)&&r.push(function(t){return Object(gt.h)(/^\s*([-+*])\s$/,t)}(e)),(e=t.nodes.codeBlock)&&r.push(function(t){return Object(gt.f)(/^```$/,t)}(e)),(e=t.nodes.heading)&&r.push(function(t,e){return Object(gt.f)(new RegExp("^(#{1,"+e+"})\\s$"),t,(function(t){return{level:t[1].length}}))}(e,6)),(e=t.nodes.todoList)&&r.push(function(t){return Object(gt.h)(/^\s*(\[ \])\s$/,t)}(e)),(e=t.nodes.hashTag)&&r.push(function(t){var e=new RegExp("(^|\\s*)#([\\w-]+)\\s$");return new gt.a(e,(function(t,e,n,r){var a;return(null===(a=t.doc.nodeAt(n))||void 0===a?void 0:a.type)!==pt.nodes.text?t.tr:t.tr.replaceRangeWith(n,r,ht(e[2])).insertText(" ")}))}()),Object(gt.d)({rules:r})}var bt=n(124),vt="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);function Ot(t,e){var n,r={};function a(t,n){if(e){var a=e[t];if(!1===a)return;a&&(t=a)}r[t]=n}if(a("Mod-z",dt.c),a("Shift-Mod-z",dt.b),a("Backspace",gt.g),vt||a("Mod-y",dt.b),a("Alt-ArrowUp",ft.e),a("Alt-ArrowDown",ft.d),a("Mod-BracketLeft",ft.f),a("Escape",ft.g),(n=t.marks.strong)&&(a("Mod-b",Object(ft.i)(n)),a("Mod-B",Object(ft.i)(n))),(n=t.marks.em)&&(a("Mod-i",Object(ft.i)(n)),a("Mod-I",Object(ft.i)(n))),(n=t.marks.code)&&a("Mod-`",Object(ft.i)(n)),(n=t.nodes.bulletList)&&a("Shift-Ctrl-8",Object(bt.d)(n)),(n=t.nodes.orderedList)&&a("Shift-Ctrl-9",Object(bt.d)(n)),(n=t.nodes.blockquote)&&a("Ctrl->",Object(ft.j)(n)),n=t.nodes.hardBreak){var o=n,i=Object(ft.b)(ft.c,(function(t,e){return e&&e(t.tr.replaceSelectionWith(o.create()).scrollIntoView()),!0}));a("Mod-Enter",i),a("Shift-Enter",i),vt&&a("Ctrl-Enter",i)}if((n=t.nodes.listItem)&&(a("Enter",Object(bt.c)(n)),a("Shift-Tab",Object(bt.a)(n)),a("Tab",Object(bt.b)(n))),(n=t.nodes.paragraph)&&a("Shift-Ctrl-0",Object(ft.h)(n)),(n=t.nodes.codeBlock)&&a("Shift-Ctrl-\\",Object(ft.h)(n)),n=t.nodes.heading)for(var c=1;c<=6;c++)a("Shift-Ctrl-"+c,Object(ft.h)(n,{level:c}));if(n=t.nodes.horizontalRule){var s=n;a("Mod-_",(function(t,e){return e&&e(t.tr.replaceSelectionWith(s.create()).scrollIntoView()),!0}))}return r}pt.nodes.hashTag;function jt(t,e){var n=[];return e&&n.push(pt.nodes.hashTag.create({tag:e.name})),pt.nodes.doc.create({noteId:t},[pt.nodes.heading.create(),pt.nodes.paragraph.create({},n)])}var yt=function(){var t=Object(ot.useParams)().noteId,e=Object(a.useState)(null),n=Object(s.a)(e,2),r=n[0],i=n[1],c=r?ut.f.fromJSON(pt,JSON.parse(r.content)):jt(t),u=Object(a.useRef)(),l=Object(a.useRef)(null);function d(){u&&r&&u.current&&!u.current.state.doc.eq(c)&&(c=u.current.state.doc,r.atomicPatch({title:p(c)||"",content:JSON.stringify(c.toJSON()),updatedAt:tt()}))}function f(t){return ct.b.create({doc:t,schema:pt,plugins:[Object(dt.a)(),mt(pt),Object(lt.a)(Ot(pt,{})),Object(lt.a)({Enter:function(t,e){var n=t.tr.selection.$anchor,r=n.nodeBefore;if((null===r||void 0===r?void 0:r.type)!==pt.nodes.text)return!1;var a=null===r||void 0===r?void 0:r.textContent.match("[^|\\s]*#([\\w-]+)$"),o=a?a[1]:"";if(0===o.length)return!1;var i=n.pos,c=i-r.textContent.length;if(e){var s=ht(o);e(t.tr.replaceWith(c,i,s).insertText(" "))}return!0}}),Object(lt.a)({"Mod-z":dt.c,"Mod-y":dt.b}),Object(lt.a)(ft.a)]})}function p(t){var e;return null===(e=t.firstChild)||void 0===e?void 0:e.textContent}return Object(a.useEffect)((function(){if(l.current&&(u.current=new st.a(l.current,{state:f(c),dispatchTransaction:function(t){!function(t,e){var n,r=t.doc,a=t.doc.attrs.noteId;t.steps.forEach((function(e,n){var o=t.docs[n];e.getMap().forEach((function(t,e,n,i){var c=[];o.nodesBetween(t,e,(function(t){c.push(t)}));var s=[];r.nodesBetween(n,i,(function(t){s.push(t)})),o.nodesBetween(t,e,(function(t){t.type===pt.nodes.hashTag&&!s.includes(t)&&a&&Q().then((function(e){e.tags.findOne().where("name").eq(t.attrs.tag).exec().then((function(t){e.tagnotes.find().where("tagId").eq(null===t||void 0===t?void 0:t.id).where("noteId").eq(a).remove()}))}))})),r.nodesBetween(n,i,(function(t){t.type===pt.nodes.hashTag&&!c.includes(t)&&a&&(console.log("add tag"),Q().then((function(e){e.tags.findByNameOrCreate(t.attrs.tag).then((function(t){e.tagnotes.upsertNoteForTag(t,a)}))})))}))}))})),null===(n=e.current)||void 0===n||n.updateState(e.current.state.apply(t))}(t,u)}}),u.current)){u.current.focus();var t=ct.f.atEnd(u.current.state.doc),e=u.current.state.tr.setSelection(t),n=u.current.state.apply(e);u.current.updateState(n)}return function(){var t;d(),null===(t=u.current)||void 0===t||t.destroy()}}),[]),Object(a.useEffect)((function(){t&&Q().then(function(){var e=Object(k.a)(j.a.mark((function e(n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=i,e.next=3,n.notes.findOne(t).exec();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[t]),Object(a.useEffect)((function(){u.current&&(u.current.updateState(f(c)),u.current&&function(t){t.focus();var e=t.state.tr,n=t.state.doc.content.size,r=ct.g.create(e.doc,n);t.dispatch(e.setSelection(r))}(u.current));var t=setInterval((function(){d()}),500);return function(){clearInterval(t),d()}}),[r]),o.a.createElement("div",{id:"editor",ref:l},o.a.createElement("div",{id:"initContent"}))},kt=function(t){var e=t.onNoteIdChange,n=Object(ot.useParams)().noteId;return Object(a.useEffect)((function(){e(n)}),[n,e]),o.a.createElement("div",{className:"note-container"},o.a.createElement(yt,null))},Et=n(216),wt=n(125),xt=(n(602),n(603),function(t){var e=t.context,n=t.selectedTag,r=t.selectedNoteId,i=Object(ot.useHistory)(),c=Object(a.useState)([]),d=Object(s.a)(c,2),f=d[0],p=d[1];Object(a.useEffect)((function(){var t=[];return Q().then((function(r){var a;(a="tag"===e&&n?function(t,e){var n=null;return Q().then((function(r){n=Y(r.notes.find().where("trashed").eq(!1).$,r.tagnotes.find().where("tagId").eq(null===t||void 0===t?void 0:t.id).$,(function(t){return t.id}),(function(t){return t.noteId})).subscribe((function(t){var n,r=[],a=Object(y.a)(t);try{for(a.s();!(n=a.n()).done;){var o=Object(s.a)(n.value,2),i=o[0],c=o[1];c&&r.push([i,c])}}catch(u){a.e(u)}finally{a.f()}e(r)}))})),n}(n,(function(t){p(t.map((function(t){var e=Object(s.a)(t,2),n=e[0];e[1];return n})))})):"inbox"===e?r.notes.getUntaggedNotes().$.subscribe((function(t){p(t)})):function(t){return t.notes.find().where("trashed").eq("trash"===e).sort({insertedAt:"desc"})}(r).$.subscribe((function(t){t&&p(t)})))&&t.push(a)})),function(){t.forEach((function(t){return t.unsubscribe()}))}}),[e,n]);var g=function(){var t=Object(k.a)(j.a.mark((function t(e){var n,r,a;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Q();case 2:return n=t.sent,r=X(),t.next=6,n.notes.insert({id:r,title:"Let's give this a title",content:JSON.stringify(jt(r,e)),tagCount:0,trashed:!1,updatedAt:tt(),insertedAt:tt()});case 6:if(a=t.sent,!e){t.next=10;break}return t.next=10,n.tagnotes.insert({id:X(),tagId:e.id,noteId:a.id,position:0,insertedAt:tt(),updatedAt:tt()});case 10:i.push(Object(Et.formatRoute)("/notes/:noteId",{noteId:r}));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),h=Object(wt.c)({id:"note_menu"}).show;return o.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},o.a.createElement("div",{className:"notes",style:{color:"#fff"}},o.a.createElement("div",{className:"button new-note",onClick:function(){return g(n||void 0)}},o.a.createElement(u.c,{ios:l.a,md:l.a})),f.map((function(t){return o.a.createElement("div",{key:t.id,className:"button note ".concat(r===t.id?"selected":""),onClick:function(){i.push(Object(Et.formatRoute)("/notes/:noteId",{noteId:t.id}))},onContextMenu:function(e){var n,r;e.preventDefault(),n=e,r=t.id,h(n,{props:{noteId:r}})}},t.title)}))),o.a.createElement(wt.b,{id:"note_menu",animation:!1},"trash"!==e&&o.a.createElement(wt.a,{onClick:function(t){var e=t.props;Q().then((function(t){t.notes.findOne(e.noteId).exec().then((function(t){null===t||void 0===t||t.trash()}))}))}},"Delete"),"trash"===e&&o.a.createElement(wt.a,{onClick:function(t){var e=t.props;Q().then((function(t){t.notes.findOne(e.noteId).exec().then((function(t){null===t||void 0===t||t.untrash()}))}))}},"Restore"),"trash"===e&&o.a.createElement(wt.a,{onClick:function(t){var e=t.props;Q().then((function(t){t.notes.findOne(e.noteId).exec().then((function(t){null===t||void 0===t||t.remove()}))}))}},"Delete Forever")))}),It=function(){return o.a.createElement("div",{style:{padding:"2em 3em"}})},Ct=function(){var t=Object(a.useState)(b()),e=Object(s.a)(t,2)[1],n=Object(a.useState)("inbox"),r=Object(s.a)(n,2),i=r[0],c=r[1],l=Object(a.useState)(null),d=Object(s.a)(l,2),f=d[0],p=d[1],g=Object(a.useState)(null),h=Object(s.a)(g,2),m=h[0],v=h[1];return Object(a.useEffect)((function(){b()&&G()}),[]),o.a.createElement(u.a,null,b()?o.a.createElement(at.a,null,o.a.createElement(u.h,{contentId:"main"},o.a.createElement(rt,{onLogout:function(){return e(!1)},onContextChange:function(t){return c(t)},currentContext:i,onTagChange:function(t){return p(t)},selectedTag:f}),o.a.createElement(xt,{context:i,selectedTag:f,selectedNoteId:m}),o.a.createElement(u.g,{id:"main"},o.a.createElement(ot.Route,{path:"/notes/:noteId",render:function(t){return o.a.createElement(kt,Object.assign({},t,{onNoteIdChange:v}))},exact:!0}),o.a.createElement(ot.Route,{path:"/",component:It,exact:!0})))):o.a.createElement(it,{onSuccess:function(){return e(!0)},onCancel:function(){}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(Ct,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[330,3,4]]]);
//# sourceMappingURL=main.36e71cc4.chunk.js.map